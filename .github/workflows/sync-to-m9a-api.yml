name: Sync Resource Data to M9A-API

on:
  # 当 data 目录有变化时自动触发
  push:
    branches:
      - main
    paths:
      - 'assets/resource/data/**'
  # 支持手动触发
  workflow_dispatch:

permissions:
  contents: read

jobs:
  sync:
    runs-on: ubuntu-latest
    
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
      
      - name: Trigger sync in M9A-API
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.DISPATCH_TOKEN }}
          script: |
            await github.rest.repos.createDispatchEvent({
              owner: 'MAA1999',
              repo: 'M9A-API',
              event_type: 'sync-resource-data',
              client_payload: {
                source_repo: context.repo.repo,
                source_ref: context.ref,
                triggered_by: context.actor
              }
            });
            console.log('已触发 M9A-API 仓库的数据同步');
